#!/usr/bin/env bash

source ~/miniconda3/bin/activate;
eval conda activate setup;

stty -echoctl # hide ^C

# function called by trap
kill_recordings() {
	printf "sigint caught\n"
	for pid in $(cat .pids); do
		kill -SIGINT $pid
	done
	rm .pids
}

trap 'kill_recordings' SIGINT

python -m tiscam.record -c configs.toml -o ~/data/cam0 -f -i 0 &
PID0=$!
python -m tiscam.record -c configs.toml -o ~/data/cam1 -f -i 1 &
PID1=$!
python -m tiscam.record -c configs.toml -o ~/data/cam2 -f -i 2 &
PID2=$!
python -m tiscam.record -c configs.toml -o ~/data/cam3 -f -i 3 &
PID3=$!
python -m tiscam.record -c configs.toml -o ~/data/cam4 -f -i 4 &
PID4=$!

sleep .1

echo -e "$PID0\n$PID1\n$PID2\n$PID3\n$PID4" > .pids
wait $PID0
